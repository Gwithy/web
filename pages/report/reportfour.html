<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <script src="../../jslib/miniui/boot.js"></script>
    <script type="text/javascript" src="./js/reportfour.js"></script>
    <title></title>
    <style>
        .mini-datagrid-cell {
            float: left;
            width: 25%;
        }
    </style>
</head>
<body>
<div class="mini-layout" style="width: 100%;height: 100%;" allowResize="false">
    <div title="north" region="north" showSplit="false" showSplitIcon="false" height="72" showHeader="false"    style="border: none;">
        <div id="p1" class="mini-panel" title="检索条件" style="width: 100%;height:100%"
             showCloseButton="false">
            <div style="margin-left: 2%;display:inline;line-height: 32px;" class="searchBar" id="reportfourForm">
                <lable class="form-label">统计年月：</lable>
                <input name="key" id="key" class="mini-monthpicker"  format="yyyy-MM" style="width:160px;"
                       required="true"  nullValue="null"  emptyText="统计年月"  allowInput="false"/>
                <input id="queryParamFlag" name="queryParamFlag" value="1" class="mini-hidden" />
                <a class="mini-button" iconCls="icon-search" onclick="PageReportfour.funSearch()" plain="true"><label>统计</label></a>
                <a class="mini-button" iconCls="icon-reset" onclick="PageReportfour.funReset()" plain="true"><label>重置</label></a>
            </div>
        </div>
    </div>
    <div title="center" region="center" allowResize="false" showSplit="true" showSplitIcon="false" allowUnselect="false" style="border:0 none;">

        <div class="mini-fit">
            <div class="mini-datagrid-cell">
                <div class="mini-toolbar" style="border-bottom:0;padding:0px;">
                    主营业务熟料计划<input  class="reportSevenGrid1" style="width: 40px;"  type="text" readonly="true" />万吨
                </div>
                <div id="reportSevenGrid1" class="mini-datagrid"
                    idField="id" allowResize="false" showPager="false" showSummaryRow="true"  ondrawsummarycell="onDrawSummaryCell"  showFooter="false"
                    pagesize="10" sizeList="[10,30,50,100]" allowAlternating="true"  sortMode="client" style="height: 92%;">
                    <div property="columns">
                        <div field="lx" headerAlign="center"  width="100">收货单位</div>
                        <div field="jhsl" width="60" headerAlign="center" allowSort="true">计划</div>
                        <div field="sjsl" width="60" headerAlign="center" allowSort="true" >实际完成</div>
                        <div field="wcl" width="50" headerAlign="center" allowSort="true">完成率</div>
                    </div>
                </div>
            </div>
            <div class="mini-datagrid-cell">
                <div class="mini-toolbar" style="border-bottom:0;padding:0px;">
                    散装运输及经营计划<input  class="reportSevenGrid2" style="width: 40px;"  type="text" readonly="true"/>万吨
                </div>
                <div id="reportSevenGrid2" class="mini-datagrid"
                    idField="id" allowResize="false" showPager="false" showSummaryRow="true"  ondrawsummarycell="onDrawSummaryCell"  showFooter="false"
                    pagesize="10" sizeList="[10,30,50,100]" allowAlternating="true"  sortMode="client" style="height: 92%;">
                    <div property="columns">
                        <div field="lx" headerAlign="center"  width="60">货物名称</div>
                        <div field="jhsl" width="60" headerAlign="center" allowSort="true">计划</div>
                        <div field="sjsl" width="60" headerAlign="center" allowSort="true" >实际完成</div>
                        <div field="wcl" width="60" headerAlign="center" allowSort="true">完成率</div>
                    </div>
                </div>
            </div>
            <div class="mini-datagrid-cell">
                <div class="mini-toolbar" style="border-bottom:0;padding:0px;">
                    集装箱计划<input  class="reportSevenGrid3" style="width: 40px;"  type="text" readonly="true" />万标箱
                </div>
                <div id="reportSevenGrid3" class="mini-datagrid" onload="onload"
                     idField="id" allowResize="false" showPager="false" showSummaryRow="true"  ondrawsummarycell="onDrawSummaryCell2"  showFooter="false"
                    pagesize="10" sizeList="[10,30,50,100]" allowAlternating="true"  sortMode="client" style="height: 92%;">
                    <div property="columns">
                        <div field="lx" width="60" headerAlign="center" allowSort="true">货物名称</div>
                        <div field="jhsl" width="60" headerAlign="center" allowSort="true" >计划</div>
                        <div field="sjsl" width="60" headerAlign="center" allowSort="true">实际完成</div>
                        <div field="wcl" width="60" headerAlign="center" allowSort="true">完成率</div>
                    </div>
                </div>
            </div>
            <div class="mini-datagrid-cell">
                <div class="mini-toolbar" style="border-bottom:0;padding:0px;">
                    船运月平均航次计划<input  class="reportSevenGrid4" style="width: 40px;"  type="text" readonly="true" />个
                </div>
                <div id="reportSevenGrid4" class="mini-datagrid"
                    idField="id" allowResize="false" showPager="false" showSummaryRow="true"  ondrawsummarycell="onDrawSummaryCell2"  showFooter="false"
                    pagesize="10" sizeList="[10,30,50,100]" allowAlternating="true"  sortMode="client" style="height: 92%;">
                    <div property="columns">
                        <div field="lx" width="80" headerAlign="center" allowSort="true">船级</div>
                        <div field="jhsl" width="60" headerAlign="center" allowSort="true" >计划</div>
                        <div field="sjsl" width="60" headerAlign="center" allowSort="true">实际完成</div>
                        <div field="wcl" width="60" headerAlign="center" allowSort="true">完成率</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    function  onload(e) {

//console.log(e);
    }
    function onDrawSummaryCell(e) {

        var result = e.result;
        var grid = e.sender;
        var rows = e.data;

        if (e.field == "lx") {
            e.cellHtml = "合计：";
        }

        if (e.field == "jhsl") {
            var jh =  0;
            for (var i = 0, l = rows.length; i < l; i++) {
                var row = rows[i];
                if(row.jhsl == '-'){
                    continue;
                } else {
                    jh += row.jhsl*1;
                }
            }
            if(jh == 0) jh ='-';
            e.cellHtml =jh;
            $("."+this.id).val(jh);
        }

        if (e.field == "sjsl") {
            var sj = 0 ;
            for (var i = 0, l = rows.length; i < l; i++) {
                var row = rows[i];
                if(row.sjsl == '-'){
                    continue;
                } else {
                    sj += row.sjsl*1;
                }
            }
            if(sj == 0) sj ='-';
            e.cellHtml = sj
        }
        if (e.field == "wcl") {
            var jh =  0;
            var sj = 0 ;
            var sjwc = 0;
            for (var i = 0, l = rows.length; i < l; i++) {
                var row = rows[i];
                if(row.sjsl == '-'){
                    continue;
                } else {
                    sj += row.sjsl*1;
                }
            }
            for (var i = 0, l = rows.length; i < l; i++) {
                var row = rows[i];
                if(row.jhsl == '-'){
                    continue;
                } else {
                    jh += row.jhsl*1;
                }
            }
            if(jh == 0 || sj == 0){
                sjwc ='-';
            }else {
                sjwc = sj / jh;
            }
            e.cellHtml = sjwc == '-'? '-':(sjwc/10000*100).toFixed(2)+"%";
        }
    }

    function onDrawSummaryCell2(e) {

        var result = e.result;
        var grid = e.sender;
        var rows = e.data;

        if (e.field == "lx") {
            e.cellHtml = "合计：";
        }

        if (e.field == "jhsl") {
            var jh =  0;
            for (var i = 0, l = rows.length; i < l; i++) {
                var row = rows[i];
                if(row.jhsl == '-'){
                    continue;
                } else {
                    jh += row.jhsl*1;
                }
            }
            if(jh == 0) jh ='-';
            e.cellHtml =jh;
            $("."+this.id).val(jh);
        }

        if (e.field == "sjsl") {
            var sj = 0 ;
            for (var i = 0, l = rows.length; i < l; i++) {
                var row = rows[i];
                if(row.sjsl == '-'){
                    continue;
                } else {
                    sj += row.sjsl*1;
                }
            }
            if(sj == 0) sj ='-';
            e.cellHtml = sj
        }
        if (e.field == "wcl") {
            var jh =  0;
            var sj = 0 ;
            var sjwc = 0;
            for (var i = 0, l = rows.length; i < l; i++) {
                var row = rows[i];
                if(row.jhsl == '-'){
                    continue;
                } else {
                    jh += row.jhsl*1;
                }
            }
            for (var i = 0, l = rows.length; i < l; i++) {
                var row = rows[i];
                if(row.sjsl == '-'){
                    continue;
                } else {
                    sj += row.sjsl*1;
                }
            }
            if(jh == 0 || sj == 0){
                sjwc ='-';
            }else {
                sjwc = sj / jh;
            }
            e.cellHtml = sjwc == '-'? '-':(sjwc*100).toFixed(2)+"%";
        }
    }

</script>
</body>
</html>
